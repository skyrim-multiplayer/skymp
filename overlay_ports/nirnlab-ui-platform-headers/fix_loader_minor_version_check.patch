From 35e7d7153ccfe01006aa28e90526bf594ccd0cf7 Mon Sep 17 00:00:00 2001
From: Roman Nikonov <code@nic11.xyz>
Date: Sun, 30 Nov 2025 19:31:02 +0100
Subject: [PATCH] Fixed minor version compatibility checks; resolved typos

---
 src/UIPlatform/NirnLabUIPlatformAPI/SKSELoader.h     | 4 ++--
 src/UIPlatform/main.cpp                              | 7 ++++---
 src/UIPlatformTest/NirnLabUIPlatformAPI/SKSELoader.h | 4 ++--
 3 files changed, 8 insertions(+), 7 deletions(-)

diff --git a/src/UIPlatform/NirnLabUIPlatformAPI/SKSELoader.h b/src/UIPlatform/NirnLabUIPlatformAPI/SKSELoader.h
index 6780e01..12d9ca7 100644
--- a/src/UIPlatform/NirnLabUIPlatformAPI/SKSELoader.h
+++ b/src/UIPlatform/NirnLabUIPlatformAPI/SKSELoader.h
@@ -52,10 +52,10 @@ namespace NL::UI::SKSELoader
                 const auto majorAPIVersion = NL::UI::APIVersion::GetMajorVersion(versionInfo->apiVersion);
                 const auto minorAPIVersion = NL::UI::APIVersion::GetMinorVersion(versionInfo->apiVersion);
                 // Different major version can cause serious compatibility issues. Older minor version may have missing methods
-                if (majorAPIVersion != NL::UI::APIVersion::MAJOR || minorAPIVersion != NL::UI::APIVersion::MINOR)
+                if (majorAPIVersion != NL::UI::APIVersion::MAJOR || minorAPIVersion < NL::UI::APIVersion::MINOR)
                 {
                     LoaderData::s_canUseAPI = false;
-                    spdlog::error("NirnLabUIPlatform loader: can't use using this API version. We have {}.{}, but {}.{} is installed",
+                    spdlog::error("NirnLabUIPlatform loader: can't use this API version. We have {}.{}, but {}.{} is installed",
                                   NL::UI::APIVersion::MAJOR,
                                   NL::UI::APIVersion::MINOR,
                                   NL::UI::APIVersion::GetMajorVersion(versionInfo->apiVersion),
diff --git a/src/UIPlatform/main.cpp b/src/UIPlatform/main.cpp
index acbcd9a..ca75fa2 100644
--- a/src/UIPlatform/main.cpp
+++ b/src/UIPlatform/main.cpp
@@ -132,9 +132,10 @@ extern "C"
         spdlog::info("NirnLabUIPlatform version: {}.{}", NL::UI::LibVersion::GetMajorVersion(thisLibVer.libVersion), NL::UI::LibVersion::GetMinorVersion(thisLibVer.libVersion));
 
         const auto requestMajorVer = NL::UI::APIVersion::GetMajorVersion(a_requestLibVersion);
-        if (requestMajorVer != NL::UI::APIVersion::MAJOR)
+        const auto requestMinorVer = NL::UI::APIVersion::GetMajorVersion(a_requestLibVersion);
+        if (requestMajorVer != NL::UI::APIVersion::MAJOR || requestMinorVer > NL::UI::APIVersion::MINOR)
         {
-            spdlog::error("Can't return API for \"{}\", this ver is {}.{} and their ver is {}.{}",
+            spdlog::error("Can't return API for \"{}\", our ver is {}.{} and their ver is {}.{}",
                           a_requestLibName == nullptr ? "null" : a_requestLibName,
                           NL::UI::APIVersion::MAJOR,
                           NL::UI::APIVersion::MINOR,
@@ -143,7 +144,7 @@ extern "C"
             return false;
         }
 
-        spdlog::info("API requested by \"{}\", this ver is {}.{} and thier ver is {}.{}",
+        spdlog::info("API requested by \"{}\", our ver is {}.{} and their ver is {}.{}",
                      a_requestLibName == nullptr ? "null" : a_requestLibName,
                      NL::UI::APIVersion::MAJOR,
                      NL::UI::APIVersion::MINOR,
diff --git a/src/UIPlatformTest/NirnLabUIPlatformAPI/SKSELoader.h b/src/UIPlatformTest/NirnLabUIPlatformAPI/SKSELoader.h
index 6780e01..12d9ca7 100644
--- a/src/UIPlatformTest/NirnLabUIPlatformAPI/SKSELoader.h
+++ b/src/UIPlatformTest/NirnLabUIPlatformAPI/SKSELoader.h
@@ -52,10 +52,10 @@ namespace NL::UI::SKSELoader
                 const auto majorAPIVersion = NL::UI::APIVersion::GetMajorVersion(versionInfo->apiVersion);
                 const auto minorAPIVersion = NL::UI::APIVersion::GetMinorVersion(versionInfo->apiVersion);
                 // Different major version can cause serious compatibility issues. Older minor version may have missing methods
-                if (majorAPIVersion != NL::UI::APIVersion::MAJOR || minorAPIVersion != NL::UI::APIVersion::MINOR)
+                if (majorAPIVersion != NL::UI::APIVersion::MAJOR || minorAPIVersion < NL::UI::APIVersion::MINOR)
                 {
                     LoaderData::s_canUseAPI = false;
-                    spdlog::error("NirnLabUIPlatform loader: can't use using this API version. We have {}.{}, but {}.{} is installed",
+                    spdlog::error("NirnLabUIPlatform loader: can't use this API version. We have {}.{}, but {}.{} is installed",
                                   NL::UI::APIVersion::MAJOR,
                                   NL::UI::APIVersion::MINOR,
                                   NL::UI::APIVersion::GetMajorVersion(versionInfo->apiVersion),
-- 
2.52.0

